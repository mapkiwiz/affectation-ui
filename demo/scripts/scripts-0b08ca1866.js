"use strict";angular.module("ihmApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/map",{templateUrl:"map/views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/map/about",{templateUrl:"map/views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/map/test",{templateUrl:"map/views/test.html",controller:"MapCtrl",controllerAs:"test"}).otherwise({redirectTo:"/map"}),t.html5Mode(!0)}]),angular.module("ihmApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("ihmApp").controller("AboutCtrl",["$scope",function(e){e.title="AboutTitle",this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("ihmApp").factory("MapContext",["$window",function(e){var t=e.L.map("map"),r={},n={lat:45.5,lng:6,zoom:9},a={toner:{layer:e.L.tileLayer("//stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"),label:"Stamen Toner"},lite:{layer:e.L.tileLayer("//stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"),label:"Stamen Toner Lite"},osm:{layer:e.L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),label:"Open Street Map"}};return{getMap:function(){return t},setOverlay:function(e,t){r[e]=t},getOverlay:function(e){return r[e]},getBounds:function(){var e=null;for(var t in r)e?e.extend(r[t].getBounds()):e=r[t].getBounds();return e},getView:function(){return n},getBaseMaps:function(){return a},fitAll:function(){var e=this.getBounds();e&&t.fitBounds(e)}}}]).controller("MapCtrl",["$scope","$window","MapContext",function(e,t,r){var n=r.getMap();e.title="TestTitle",e.setBaseMap=function(t){n.removeLayer(e.basemap.layer),t.layer.addTo(n),e.basemap=t},e.fitAll=function(){r.fitAll()},e.init=function(){e.mapcontext=r,e.basemaps=r.getBaseMaps(),e.basemap=e.basemaps.lite,e.basemaps.lite.layer.addTo(n);var a=r.getView();n.setView(t.L.latLng(a.lat,a.lng),a.zoom,!0)},e.$on("enqueteur.selected",function(t,r,n){e.$broadcast("enqueteur.selected.bc",r,n)}),e.$on("map.data.loaded",function(){r.fitAll()}),e.init()}]),angular.module("ihmApp").factory("EnqueteursService",["$http","$cacheFactory",function(e,t){var r=null,n=t.get("$http"),a=function(t){return t&&n.removeAll(),e.get("data/enqueteurs.geojson",{cache:!0}).then(function(e){r=e.data})};return{getEntities:a,entities:function(){return r}}}]).controller("EnqueteursCtrl",["$scope","$window","$location","$anchorScroll","MapContext","EnqueteursService",function(e,t,r,n,a,o){var i=a.getMap();e.selected=void 0,e.$watch(o.entities,function(r,n){r&&(e.enqueteurs=r.features,e.layer=t.L.geoJson(r,{onEachFeature:function(t,r){r.on("click",function(r){e.$emit("enqueteur.selected",t.properties.gid,!1),e.$apply()}),r.bindPopup(t.properties.prenom,{closeButton:!1}),t.properties.marker=r}}),e.layer.addTo(i),e.$emit("map.data.loaded"),a.setOverlay("enqueteurs",e.layer))}),e.selectItem=function(t){e.$emit("enqueteur.selected",t.properties.gid,!0),t.properties.marker.bounce({duration:1500,height:120})},e.findEntity=function(t){if(e.enqueteurs)for(var r in e.enqueteurs)if(e.enqueteurs[r].properties.gid==t)return e.enqueteurs[r];return void 0},e.$on("enqueteur.selected",function(t,a,o){var u=e.findEntity(a);u&&(e.selected=a,r.hash("enqueteur"+a),o&&i.panTo({lon:u.properties.lon,lat:u.properties.lat}),n())}),this.getLayer=function(){return e.layer},o.getEntities()}]),angular.module("ihmApp").factory("UnitesService",["$http","$cacheFactory",function(e,t){var r=null,n=t.get("$http"),a=function(t){return t&&n.removeAll(),e.get("data/us.geojson",{cache:!0}).then(function(e){r=e.data})};return{getEntities:a,entities:function(){return r}}}]).controller("UnitesCtrl",["$scope","$window","MapContext","UnitesService",function(e,t,r,n){var a=r.getMap();e.status=function(e,t){return t?e.properties.enqueteur?e.properties.enqueteur==t?"us-marker us-marker-selected":"us-marker us-marker-assigned-other":"us-marker us-marker-unassigned":e.properties.enqueteur?"us-marker us-marker-assigned-other":"us-marker us-marker-unassigned"},e.featureToMarker=function(r,n,a){var o=t.L.divIcon({className:e.status(r,a),html:'<span class="glyphicon glyphicon-record"></span>',iconSize:t.L.point(20,20)});return t.L.marker(n,{icon:o})},e.drawLayer=function(n){e.unites&&(e.layer&&a.removeLayer(e.layer),e.layer=t.L.geoJson(e.unites,{pointToLayer:function(t,r){return e.featureToMarker(t,r,n)},onEachFeature:function(t,r){n&&r.on("click",function a(r){e.layer.removeLayer(this),t.properties.enqueteur==n?t.properties.enqueteur=void 0:t.properties.enqueteur=n;var o=e.featureToMarker(t,this.getLatLng(),n);o.addTo(e.layer),o.on("click",a),e.$apply()}),t.properties.marker=r}}),e.layer.addTo(a),r.setOverlay("unites",e.layer))},e.$watch(n.entities,function(t,r){t&&(e.unites=t,e.drawLayer(),e.$emit("map.data.loaded"))}),e.$on("enqueteur.selected.bc",function(t,r){e.drawLayer(r)}),n.getEntities()}]);